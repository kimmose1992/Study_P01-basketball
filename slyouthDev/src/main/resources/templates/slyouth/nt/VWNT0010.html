<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
	<th:block th:replace="fragments/cm/header :: fragment-header" />
	<script th:inline="javascript">
		$(document).ready(function(){
			
			/**
			 * [조회] 버튼 클릭 이벤트
			 * - 검색창에 입력한 내용으로 리스트를 조회합니다.
			 */
 			$("#searchBtn").click(function(){
 				fn_search();
			});	
			
 			/**
			 * [조회] 검색폼 엔터 이벤트
			 * - 검색폼에서 엔터 클릭 시 리스트를 조회한다.
			 */
			$("#searchForm").keydown(function(e){
				if(e.keyCode == 13){
					fn_search();
				}
			})
		});
		
		/**
		 * [등록] 버튼 클릭 이벤트
		 * - 게시글을 등록하는 화면으로 이동한다.
		 */
		 function fn_moveRegist(){
			var params = {};
			params.editDivCd = "I";
			
			com.movePagePost("/nt/sharingEdit",params);
		};
		
		 /**
		 * [상세조회] 버튼 클릭 이벤트
		 * - 게시글을 상세조회하는 화면으로 이동한다.
		 */
		function sharingDetail(cmntyNo){
			var params = {};
			params.cmntyNo = cmntyNo; 
			params.pageNo = $("#pageNo").val();
			
			com.movePagePost("/nt/sharingDetail", params);
		};
	
		/**
		 * [조회] 자유게시판 목록 조회 이벤트
		 * - 검색창에 입력한 내용으로 리스트를 조회한다.
		 */
		function fn_search() {
			var params = $("#searchForm").serializeObject();
			com.movePagePost("/nt/sharingList", params);
		};
		
		/**
		 * 좋아요 함수
		 * -  좋아요 기능을 구현합니다.
		 */
		function likeCount(index,src) {
			var params = {};
			var cmntyNo = $("#cmntyNo" + index).text();
			params.cmntyNo = cmntyNo; 
			
			// 현재페이지 주소를 가져옵니다.
			var link = document.location.href; 
			var lastindex = link.indexOf("/",8);
			// 이미지 주소와 현재페이지 주소를 합쳐줍니다.
			link = link.substring(0, 21) + "/images/slyouth/dislike.png";
			
			if(src == link) {  
				com.loadAjaxPost("/nt/updateLikePuls", params, function(res){
					
					$("#likeCnt"+index).text(res);
					$("#like"+index).attr('src','/images/slyouth/like.png');
				});
			} else {
				com.loadAjaxPost("/nt/updateLikeMinus", params, function(res){
					
					$("#likeCnt"+index).text(res);
					$("#like"+index).attr('src','/images/slyouth/dislike.png');
				});
			}
		};
		
	
	</script>
</head>
<body>
	<!-- asideMenu -->
	<div th:replace="fragments/cm/layout/asideMenu :: fragment-asideMenu"></div>

	<!-- headerMenu -->
	<div th:replace="fragments/cm/layout/headerMenu :: fragment-headerMenu"></div>
	
	<div id="wrap">
		<div id="section_wrap">
			
		<!-- Worship Visual -->
		<section class="worship_visual">
           	<div th:replace="fragments/cm/layout/worshipVisual :: fragment-worshipVisual"></div>
		</section>
			
		<section class="community_list_wrap">
			
			<!-- Search -->
			<div class="search_wrap" th:object="${returnSVO.ntSharingDVO}">
				<div class="community_list_title">
	            	<p>커뮤니티</p>
	                <h2>나눔</h2>
	            </div>     
	            <form id="searchForm" >
					<table>
						<tbody>
							<tr>
								<td class="search_division" for="title">제목</td>
								<td class="search_inputbox">
									<input type="text" id="title" name="title" th:value="*{title}"/>
								</td>
							</tr>
						</tbody>
					</table>
				</form>
				<div class="search_btn">
					<div class="search_btn_wrap">
						<input type="button" class="Btn" value="조회" id="searchBtn"/>
					</div>
				</div>
			</div>
			<!-- Search -->
			<!-- List -->			
		    <div class="community_list_table_wrap">
				<table class="community_list_table">
					<thead>
						<tr>
							<th>번호</th>
		                    <th>작성자</th>
		                    <th>제목</th>
		                    <th>등록일</th>
		                    <th>조회수</th>
		                    <th>좋아요</th>
		                </tr>
					</thead>
					<tbody>
						<tr th:if="${not #lists.isEmpty(returnSVO.ntSharingDVOList)}"  th:each="ntSharingDVO, rowStat: ${returnSVO.ntSharingDVOList}">
							<td th:onclick="sharingDetail([[ ${ntSharingDVO.cmntyNo} ]]);" th:text="${ntSharingDVO.cmntyNo}" th:id="cmntyNo + ${rowStat.index}"></td>
							<td th:text="${ntSharingDVO.name}"></td>
							<td th:onclick="sharingDetail([[ ${ntSharingDVO.cmntyNo} ]]);" th:text="${ntSharingDVO.title}" id="title"></td>
							<td th:text="${#temporals.format(ntSharingDVO.frsRegDt,'yyyy-MM-dd HH:mm')}"></td>
							<td th:text="${ntSharingDVO.viewCnt}"></td>	
							<td>
								<!-- <img th:src="@{/images/slyouth/dislike.png}" th:id="like + ${rowStat.index}" th:onclick="likeCount([[ ${rowStat.index} ]], this.src);" style="width:25px; height:25px;">
								<p th:text="${ntSharingDVO.likeCnt}" th:id="likeCnt + ${rowStat.index}"></p> -->
							</td>	
						</tr>
						<tr th:unless="${not #lists.isEmpty(returnSVO.ntSharingDVOList)}">
							<td colspan="5">조회된 결과가 없습니다.</td>
						</tr>
					</tbody>
				</table>
				<!-- Button -->
				<button type="button" id="registBtn" value="글등록" th:text="|글등록|" th:onclick="fn_moveRegist()"></button>
			</div>
		</section>
		
		<!-- Paging -->
		<div class="worship_video_list_nav">	
			<div th:replace="fragments/cm/pagination :: fragment-pagination" id="pagination"></div>
		</div>	
		<!-- footer -->
		<div th:replace="fragments/cm/layout/footer :: fragment-footer"></div>
		</div>
	</div>
</body>
</html>