<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
	<th:block th:replace="fragments/cm/header :: fragment-header" />
	<script>
		$(document).ready(function(){
			/**
			 * [목록] 버튼 클릭 이벤트
			 * - 건의사항 목록 조회 페이지로 이동한다.
			 */
			$("#suggestList").click(function(){
				location.href = "/nt/suggestList";
			});
		});
		
		/**
		 * [수정] 버튼 클릭 이벤트
		 * - 상담글을 수정하는 페이지로 이동한다.
		 */
		function suggestEdit(suggestDVO){
			var params = {};
			params.cmntyNo = suggestDVO.cmntyNo;
			params.grpNo = suggestDVO.grpNo;
			params.grpOrd = suggestDVO.grpOrd;
			
			params.selDivCd = 'U';
			
			com.movePagePost("/nt/suggestEdit", params);
		}
		
		/**
		 * [삭제] 버튼 클릭 이벤트
		 * - 상담글을 삭제한다. (삭제는 작성자 본인/교역자/관리자만 가능하다 - 답글이 존재하는 글의 경우 삭제가 불가하다.)
		 * - 관리자의 강제 삭제 가능여부 논의필요
		 */
		function suggestDelete(suggestDVO){
			var params = {};
			params.cmntyNo = suggestDVO.cmntyNo;
			params.grpNo = suggestDVO.grpNo;
			params.grpOrd = suggestDVO.grpOrd;

			var deleteConfirm = confirm("삭제하시겠습니까?");
			if(deleteConfirm){
				com.loadAjaxPost("/nt/suggestDelete", params, fn_suggestDeleteCallback);
			}
		}
		
		/**
		 * [답글] 버튼 클릭 이벤트
		 * - 상담 본 글에 대한 답글 페이지로 이동한다.
		 */
		function suggestReply(suggestDVO){
			var params = {};
			params.cmntyNo = suggestDVO.cmntyNo;
			params.mngNo = suggestDVO.mngNo;
			
			params.grpNo = suggestDVO.grpNo;
			params.grpOrd = suggestDVO.grpOrd;

			params.openYn = suggestDVO.openYn;
			
			params.selDivCd = 'RS';
			
			grpCount = suggestDVO.grpCount;
			if(grpCount > 1){
				alert("답변이 완료된 글입니다.")
			}else{
				com.movePagePost("/nt/suggestEdit", params);
			}
		}
		
		/**
		 * suggestDelete callback 메소드
		 * - 삭제 시 callback 처리되는 함수이다.
		 */
		function fn_suggestDeleteCallback(data){
			if(data.resultCnt > 0){
				alert("삭제되었습니다.");
				location.href = "/nt/suggestList";
			}else if(data.resultCnt == -1){
				alert("답글이 존재하여 삭제가 불가능합니다.");
			}else{
				alert("DB 에러가 발생하였습니다.");
			}
		}
	</script>
</head>
<body>
	<!-- asideMenu -->
	<div th:replace="fragments/cm/layout/asideMenu :: fragment-asideMenu"></div>
	
	<!-- header -->
	<div th:replace="fragments/cm/layout/headerMenu :: fragment-headerMenu"></div>
	
	<div id="wrap">
		<div id="section_wrap">
			<!-- Worship Visual -->
			<section class="worship_visual">
            	<div th:replace="fragments/cm/layout/worshipVisual :: fragment-worshipVisual"></div>
			</section>
			
			<section class="community_list_wrap">
				<div class="community_list_title">
					<p>커뮤니티</p>
            		<h2>건의사항</h2>
        		</div>

				<div class="view_details_content">
					<form role="form" th:object=${returnSVO.ntSuggestDVO}>
						<div class="view_details_content_title">
							<h2 th:text="*{title}"></h2>
							<p th:text="*{name}"></p>
						</div>
						<div class="view_details_content_info">
							<div>
								<p>조회수 :</p><span th:text="*{viewCnt}"></span>
							</div>
							<div>
								<p>담당사역자 :</p><span th:text="*{mngNm}"></span>
							</div>
							<div>
								<p>수정일시 :</p><span th:text="${#temporals.format(returnSVO.ntSuggestDVO.lstMdfDt, 'yyyy-MM-dd HH:mm')}"></span>
							</div>
							
						</div>
						<div class="view_details_Contents">
							<p th:utext="*{content}"></p>
						</div>
						<div class="view_details_content_btn_wrap">
							<div class="next_generation_info_delete_modifications">	
								<input type="button" th:onclick="suggestEdit([[ ${returnSVO.ntSuggestDVO} ]])" th:value="|수정|" class="Btn" >
								<input type="button" th:onclick="suggestDelete([[ ${returnSVO.ntSuggestDVO} ]])" th:value="|삭제|" class="Btn" >
								<input type="button" th:if="${returnSVO.ntSuggestDVO.grpOrd == 0}" th:onclick="suggestReply([[ ${returnSVO.ntSuggestDVO} ]])" th:value="|답글|" class="Btn" >
								<input type="button" id="suggestList" class="Btn" th:value="|목록|">
							</div>
						</div>
					</form>
				</div>
			</section>
			
			<!-- footer -->
			<div th:replace="fragments/cm/layout/footer :: fragment-footer"></div>
		</div>
	</div>	
</body>
</html>