<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
	<!--
	개발자	: 송근영
	작성일자	: 2021.09.29
	화면명 	: 동아리 게시판 상세 조회
	서비스 	: NtCircle*
	-->
	<th:block th:replace="fragments/cm/header :: fragment-header" />
	<script type="text/javascript">
		
		// 전역 변수
		var slyouthTbKey;
	
		$(window).on("load", function(){
			slyouthTbKey = $("#refTbKey").val();
		});
	
		$(document).ready(function(){
			
			// 초기화면 구성
			fn_defineForm();
			
			/**
	         * [수정] 버튼 이벤트
			 * - 게시판 수정페이지로 이동합니다.
			 */
			$("#modifyBoardBtn").click(function(){
				// 게시판 수정
				fn_modifyBoard();
			});
			
			/**
	         * [삭제] 버튼 이벤트
			 * - 게시판 상세를 삭제합니다.
			 */
			$("#deleteBoardBtn").click(function(){
				// 게시판 삭제
				fn_deleteBoard();				
			});
			
			/**
	         * [목록] 버튼 이벤트
			 * - 동아리 상세로 돌아갑니다.
			 */
			$("#boardListBtn").click(function(){
				// 목록 돌아가기
				fn_boardList();
			});
		});
		
		/**
         * 초기화면 구성 함수
		 * - 페이지 로드 시 초기화면을 구성한다.
		 */
		function fn_defineForm() {
			
		};
		
		/**
		 * 게시판 수정 페이지 메소드
		 * - 게시판 수정페이지로 이동
		 */
		function fn_modifyBoard() {
			var params = {};
			params.cmntyNo = $("#cmntyNo").val();
			params.editDivCd = "U";
			params.slyouthTbKey = slyouthTbKey;
			com.movePagePost("/nt/circleBoardEdit", params);
		}
		
		/** 
		 * 게시판 삭제 메소드
		 * - 게시판 정보를 삭제합니다
		 */
		function fn_deleteBoard() {
			var params = {};
			params.cmntyNo = $("#cmntyNo").val();
			params.eventDivCd = $("#eventDivCd").val();
			params.fileNo = $("#fileNo").val();
			params.slyouthTbKey = slyouthTbKey;
			
			if ( confirm("삭제하시겠습니까?") ) {
				com.loadAjaxPost("/nt/circleBoardDel", params, fn_deleteBoardCallback);	
			}
		}
		
		/** 
		 * 목록 조회 메소드
		 * - 동아리 상세로 이동
		 */
		function fn_boardList() {
			var params = $("#boardForm").serializeObject();
			params.editDivCd = "";
			
			com.movePagePost("/nt/circleDetail", params);
		}
		
		/****************
		 * 콜백 메소드
		 ****************/
		 
		/**
		 * 게시판 삭제 이벤트 콜백함수
		 * - data : DB 삭제 쿼리 실행 후 결과값(정상삭제 : 1, 삭제실패 : 0)
		 */
		function fn_deleteBoardCallback(data) {
			if ( data != null && data != 0 && data != "" && data != undefined) {
				alert("게시물이 삭제되었습니다.");
				var params = $("#boardForm").serializeObject();
				com.movePagePost("/nt/circleDetail", params);
			} else {
				alert("게시물 삭제에 실패했습니다.");
				return;
			}
		}
	</script>
</head>
<body>
	<!-- asideMenu -->
	<div th:replace="fragments/cm/layout/asideMenu :: fragment-asideMenu"></div>
	
	<!-- header -->
	<div th:replace="fragments/cm/layout/headerMenu :: fragment-headerMenu"></div>
	
	<div id="wrap">
		<div id="section_wrap">
			<!-- Worship Visual -->
			<section class="worship_visual">
            	<div th:replace="fragments/cm/layout/worshipVisual :: fragment-worshipVisual"></div>
			</section>
			
			<!-- Title -->
			<div id="title_wrap">
				동아리 게시판 상세
			</div>
			
			
			<!-- BoardDetail -->
			<div id="board_wrap" th:object="${returnSVO.ntCircleCmnty}">
			
				<!-- Hidden -->
				<form id="boardForm">
					<input type="hidden" id="cmntyNo" name="cmntyNo" th:value="*{cmntyNo}">
					<input type="hidden" id="eventNo" name="eventNo" th:value="*{eventNo}">
					<input type="hidden" id="eventDivCd" name="eventDivCd" th:value="*{eventDivCd}">
					
					<!-- File -->
					<input type="hidden" id="fileNo" name="fileNo" th:value="${returnSVO.ntCircleCmntyFile.fileNo}" />
					<input type="hidden" id="refDivCd" name="refDivCd" th:value="*{eventDivCd}">
					<input type="hidden" id="refTbKey" name="refTbKey" th:value="${slyouthTbKey}" />
				</form>
												
				<!-- Detail -->
				<p>[[ *{title} ]]</p>
				<P>등록일 : [[ ${#temporals.format(returnSVO.ntCircleCmnty.lstMdfDt, 'yyyy-MM-dd')} ]]</P>
				<P>작성자 : [[ *{name} ]]</P>
				<p>조회수 : [[ *{viewCnt} ]]</p>
				<p th:utext="|내용 : *{content}|"></p>
				
				<!-- File -->
				첨부파일
				<a th:href="@{/cm/fileDownload/{no}(no=${returnSVO.ntCircleCmntyFile.fileNo})}">[[${returnSVO.ntCircleCmntyFile.fileNm}]]</a>
			</div>
			
			<!-- Button -->
			<div id="button_wrap">
				<input type="button" id="modifyBoardBtn" value="수정">
				<input type="button" id="deleteBoardBtn" value="삭제">
				<input type="button" id="boardListBtn" value="목록">
			</div>
			
			<!-- footer -->
			<div th:replace="fragments/cm/layout/footer :: fragment-footer"></div>
		</div>
	</div>
</body>
</html>