<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="yg.sharing">
	<!--  나눔자료게시판 입력된 정보로 조회된 데이터 건수 리턴 -->
	<select id="selectSharingTotalCnt" parameterType="YgSharingDVO" resultType="int">
	<![CDATA[
		SELECT COUNT(*)
		  FROM TB_CMNTY A
	INNER JOIN TB_CHRMGNT B
			ON A.LST_MDF_NO = B.CHR_NO
		 WHERE A.CMNTY_DIV_CD = 'YGP'
	]]>
	<if test="title != null and title != ''">
		   <!-- 제목 -->
		   AND A.TITLE LIKE CONCAT('%', #{title}, '%')
	</if>
	</select>
	
	<!--  나눔자료게시판 게시물 리스트 형태 조회 쿼리 -->
	<select id="selectSharingList" resultType="YgSharingDVO">
	<include refid="cm.com.pagingTop"/>
	
	<![CDATA[
		SELECT A.CMNTY_NO									/* 커뮤니티번호 */
			 , A.WRT_DIV_CD									/* 작성구분코드 */
			 , A.TITLE										/* 제목 */
			 , A.CONTENT									/* 내용 */
		     , A.LST_MDF_DT									/* 최종수정일시 */
		     , A.VIEW_CNT 									/* 조회수 */
		     , B.NAME										/* 이름 */
		  FROM TB_CMNTY A 									/* TB_커뮤니티 */
	INNER JOIN TB_CHRMGNT B									/* TB_교적관리 */
			ON A.LST_MDF_NO = B.CHR_NO
		 WHERE A.CMNTY_DIV_CD = 'YGP'
	]]>
	<if test="wrtDivCd != null and wrtDivCd != ''">
		   <!-- 자유게시판 구분 -->
		   AND A.WRT_DIV_CD = #{wrtDivCd}
	</if>
	<if test="title != null and title != ''">
		   <!-- 제목 -->
		   AND A.TITLE LIKE CONCAT('%', #{title}, '%')
	</if>
	<include refid="cm.com.pagingBottom" />
	</select>
	
	<!-- 나눔자료게시판 게시물 상세조회 쿼리 -->
	<select id="selectSharingInfo" parameterType="YgSharingDVO" resultType="YgSharingDVO">
	<![CDATA[
		SELECT A.CMNTY_NO								/* 커뮤니티번호 */
			 , A.WRT_DIV_CD								/* 작성구분코드 */
			 , A.TITLE									/* 제목 */
			 , A.CONTENT								/* 내용 */
		     , A.VIEW_CNT 								/* 조회수 */
		     , B.NAME									/* 이름 */
		     , A.LST_MDF_DT								/* 최종수정일시 */
		  FROM TB_CMNTY A 								/* TB_커뮤니티 */
	INNER JOIN TB_CHRMGNT B								/* TB_교적관리 */
			ON A.LST_MDF_NO = B.CHR_NO
		 WHERE A.CMNTY_DIV_CD = 'YGP'
		   AND A.CMNTY_NO = #{cmntyNo}
	]]>		
	</select>
	
	<!-- 나눔자료게시판 게시물 등록 쿼리 -->
	<insert id="insertSharingInfo" parameterType="YgSharingDVO">
	<![CDATA[
		INSERT 
		  INTO TB_CMNTY
			   (	
			    CMNTY_MNG_NO	/* 커뮤니티관리번호 */
			  , WRT_DIV_CD		/* 작성구분 */
			  , TITLE			/* 제목 */
	   		  , CONTENT			/* 내용 */
	   		  , FRS_REG_NO		/* 최초등록자 */
	   		  , LST_MDF_NO		/* 최종수정자 */
	   		  , CMNTY_DIV_CD	/* 커뮤니티구분코드 */
			   )
		VALUES (
				( SELECT CMNTY_MNG_NO
				    FROM TB_CMNTY_MNG
				   WHERE CMNTY_DIV_CD = 'YGP' )
			  ,	#{wrtDivCd}
			  , #{title}
			  , #{content}
			  , #{chrNo}
			  , #{chrNo}
			  , 'YGP'
			   )
	]]>
	</insert>
	
	<!-- 나눔자료게시판 게시물 수정 쿼리 -->
	<update id="updateSharingInfo" parameterType="YgSharingDVO">
	<![CDATA[
		UPDATE TB_CMNTY					/* TB_커뮤니티 */
		   SET WRT_DIV_CD = #{wrtDivCd}	/* 작성구분 */
		     , TITLE = #{title} 		/* 제목 */
		   	 , CONTENT = #{content}		/* 내용 */
		   	 , LST_MDF_NO = #{chrNo}	/* 최종수정자 */
		   	 , LST_MDF_DT = NOW()		/* 최종수정일시 */
		 WHERE CMNTY_NO = #{cmntyNo}
		   AND CMNTY_DIV_CD = 'YGP'
	]]>
	</update>
	
	<!-- 나눔자료게시판 게시물 삭제 쿼리 -->
	<delete id="deleteSharingInfo" parameterType="YgSharingDVO">
	<![CDATA[
		DELETE 
		  FROM TB_CMNTY
		 WHERE CMNTY_NO = #{cmntyNo}
	]]>	
	</delete>
</mapper>