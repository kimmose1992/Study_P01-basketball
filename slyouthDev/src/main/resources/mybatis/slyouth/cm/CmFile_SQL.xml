<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="cm.file">
	
	<!-- 파일정보 저장 -->
	<insert id="saveFileInfo" parameterType="CmFileDVO">
		<![CDATA[
		INSERT 
		  INTO TB_FILE
		       (
		        REF_NO
		      , REF_DIV_CD
		      , REF_TB_KEY
		      , FILE_NM
		      , FILE_TYPE
		      , FILE_SIZE
		      , SAVE_PTH
		      , SAVE_FILE_NM
		      , TMP_FILE_ID
		       )
		VALUES (
				#{refNo}
			  , #{refDivCd}
			  , #{refTbKey}
			  , #{fileNm}
			  , #{fileType}
			  , #{fileSize}
			  , #{savePth}
			  , #{saveFileNm}
			  , #{tmpFileId}
			   )
		]]>	
		<selectKey keyProperty="fileNo" resultType="int">
	        SELECT LAST_INSERT_ID()
	    </selectKey>
	</insert>

	<!-- 첨부파일번호로 파일정보 조회 -->
	<select id="selectFileInfoNo" parameterType="CmFileDVO" resultType="CmFileDVO">
	<![CDATA[
		SELECT FILE_NO
			 , REF_NO
	         , REF_DIV_CD
	         , REF_TB_KEY
	         , FILE_NM
	         , FILE_TYPE
	         , FILE_SIZE
	         , SAVE_PTH
	         , SAVE_FILE_NM
	         , DOWN_CNT
	         , FILE_REG_DT
	         , TMP_FILE_ID
		  FROM TB_FILE
		 WHERE FILE_NO = #{fileNo}
	]]>
	</select>
	
	<!-- 참조키로 파일정보 조회 -->
	<select id="selectFileInfoRef" parameterType="CmFileDVO" resultType="CmFileDVO">
	<![CDATA[
		SELECT FILE_NO
			 , REF_NO
	         , REF_DIV_CD
	         , REF_TB_KEY
	         , FILE_NM
	         , FILE_TYPE
	         , FILE_SIZE
	         , SAVE_PTH
	         , SAVE_FILE_NM
	         , DOWN_CNT
	         , FILE_REG_DT
	         , TMP_FILE_ID
		  FROM TB_FILE
		 WHERE REF_NO = #{refNo}
		   AND REF_DIV_CD = #{refDivCd}
		   AND REF_TB_KEY = #{refTbKey}
	]]>
	</select>
	
	<!-- 첨부파일번호로 파일정보 삭제 -->
	<delete id="deleteFileInfoNo" parameterType="CmFileDVO">
	<![CDATA[
		DELETE 
		  FROM TB_FILE
		 WHERE FILE_NO = #{fileNo}
	]]>
	</delete>
</mapper>