<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="nt.shr">
	
	<!-- 나눔(SHR) 조회 -->
	<select id="ntSharingList" parameterType="NtSharingDVO" resultType="NtSharingDVO">
	<include refid="cm.com.pagingTop" />
	
	<![CDATA[
		SELECT A.CMNTY_NO            		/* 커뮤니티번호*/
             , A.TITLE                  	/* 제목 */
             , A.CONTENT               		/* 내용 */
             , A.FRS_REG_DT               	/* 최초등록일시 */
             , A.LST_MDF_DT             	/* 최종수정일시 */
             , A.VIEW_CNT               	/* 조회수 */
			 , A.CMNTY_DIV_CD            	/* 커뮤니티구분코드 */
             , A.WRT_DIV_CD               	/* 글구분코드 */
             , A.FRS_REG_NO              	/* 최초등록자번호 */
             , A.LST_MDF_NO            		/* 최종수정자번호*/
             , B.CHR_NO 					/* 교적번호 */
             , B.NAME						/* 이름 */
		  FROM TB_CMNTY A
	INNER JOIN TB_CHRMGNT B
	        ON A.FRS_REG_NO = B.CHR_NO
		 WHERE A.CMNTY_DIV_CD = "SHR"
	]]>
	
	<if test="title != null and title != ''">
    <!-- 제목 -->   
		   AND A.TITLE LIKE CONCAT('%', #{title}, '%')
    </if>
   
	<include refid="cm.com.pagingBottom" />
	</select>
	
	<!-- 목록 건수 조회 -->
	<select id="selectSharingTotalCnt" parameterType="NtSharingDVO" resultType="int">
	<![CDATA[
		SELECT COUNT(*)
		  FROM TB_CMNTY					/* TB_공통코드 */					 	
		 WHERE CMNTY_DIV_CD = "SHR"
	]]>	
	
	<if test="title != null and title != ''">
    <!-- 제목 -->   
		   AND TITLE LIKE CONCAT('%', #{title}, '%')
    </if>
    
	</select>
	
	<!-- 나눔(SHR) 상세조회 -->
	<select id="ntSharingDetail" parameterType="NtSharingDVO" resultType="NtSharingDVO">
	<![CDATA[
		SELECT A.CMNTY_NO					/* 커뮤니티번호 */
			 , A.TITLE						/* 제목 */
			 , A.LST_MDF_DT				/* 최종수정일시 */
			 , A.FRS_REG_DT				/* 최초등록일시 */
			 , A.VIEW_CNT					/* 조회수 */
			 , A.CONTENT					/* 내용 */
			 , A.CMNTY_DIV_CD				/* 커뮤니티구분코드 */
			 , A.CMNTY_DIV_CD				/* 글구분코드 */
			 , A.FRS_REG_NO           		/* 최초등록자번호 */
             , A.LST_MDF_NO          	 	/* 최종수정자번호*/
             , B.CHR_NO 					/* 교적번호 */
             , B.NAME						/* 이름 */
          FROM TB_CMNTY A
	INNER JOIN TB_CHRMGNT B
	        ON A.FRS_REG_NO = B.CHR_NO
		 WHERE CMNTY_NO = #{cmntyNo}
	]]>
	</select>
	
	<!-- 나눔(SHR) 등록 -->
	<insert id="ntSharingInsert" parameterType="NtSharingDVO">
	<![CDATA[
		INSERT 
		  INTO TB_CMNTY
		       (
		        TITLE				/* 제목 */
		  	  , CONTENT				/* 내용 */	
			  , VIEW_CNT			/* 조회수 */ 
			  , CMNTY_DIV_CD		/* 커뮤니티구분코드 */
			  , WRT_DIV_CD			/* 글구분코드 */
			  , FRS_REG_NO			/* 최초등록자 */
			  , LST_MDF_NO			/* 최종수정자 */
			  , FRS_REG_DT			/* 최초등록일시 */
			  , LST_MDF_DT			/* 최종수정일시*/
			  , GRP_NO				/* 그룹번호 */		
		       ) 
		VALUES (
		        #{title}			
			  , #{content}
			  , #{viewCnt}
			  , 'SHR'
			  , 'SHR'
			  , #{chrNo}			  
			  , #{chrNo}
			  , NOW()
			  , NOW()
			  , (
					SELECT CMNTY_NO
					  FROM TB_CMNTY ALIAS_FOR_SUBQUERY
				  ORDER BY CMNTY_NO DESC
				     LIMIT 1
				) + 1
		       )
		          
	]]>
	</insert>
	
	<!-- 나눔(SHR) 수정 -->
	<update id="ntSharingUpdate" parameterType="NtSharingDVO">
	<![CDATA[
		UPDATE TB_CMNTY
		   SET TITLE = #{title}					/* 제목 */		
		     , CONTENT = #{content}				/* 내용 */
		     , LST_MDF_NO = #{chrNo}			/* 최종수정자 */
		   	 , LST_MDF_DT = NOW()				/* 최종수정일시 */
		 WHERE CMNTY_NO = #{cmntyNo}
	]]>
	</update>
	
	<!-- 나눔(SHR) 조회수 -->
	<update id="ntSharingCnt" parameterType="int">
	<![CDATA[
		UPDATE TB_CMNTY
		   SET VIEW_CNT = VIEW_CNT + 1			/* 조회수 */
		 WHERE CMNTY_NO = #{cmntyNo}	
	
	]]>
	</update>
	
	<!-- 나눔(SHR) 삭제 -->
	<delete id="ntSharingDelete" parameterType="NtSharingDVO">
	<![CDATA[
		DELETE FROM
		       TB_CMNTY
		 WHERE CMNTY_NO = #{cmntyNo}
	]]>
	</delete>
	
	
</mapper>