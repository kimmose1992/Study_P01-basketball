<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="um.member">

	<!-- 교인정보 전체하기 -->
	<select id="memberList" parameterType="UmMemberDVO" resultType="UmMemberDVO">
	<include refid="cm.com.pagingTop" />
	
	<![CDATA[
		SELECT A.CHR_NO												/* 교적번호 */
		     , A.CHR_REG_YMD										/* 교적등록일자 */
		     , (SELECT S1.CD_NM										/* 교적구분코드이름 */
	   			  FROM TB_CODE S1
	   		INNER JOIN TB_CHRMGNT S2
	        		ON S1.CD_VL = S2.CHR_DIV_CD
			  	 WHERE S2.CHR_NO = A.CHR_NO
			  	   AND S1.TSK_DIV_CD = 'UM'
			  	)   AS CHR_DIV_CD_NM
		     , (SELECT S1.CD_NM										/* 직책구분코드 */
	   			  FROM TB_CODE S1
	   		INNER JOIN TB_CHRMGNT S2
	        		ON S1.CD_VL = S2.POS_DIV_CD
			  	 WHERE S2.CHR_NO = A.CHR_NO
			  	   AND S1.TSK_DIV_CD = 'UM'
			  	)   AS POS_DIV_CD_NM
		     , (SELECT S1.CD_NM										/* 직책상세코드 */
	   			  FROM TB_CODE S1
	   		INNER JOIN TB_CHRMGNT S2
	        		ON S1.CD_VL = S2.POS_DTL_CD
			  	 WHERE S2.CHR_NO = A.CHR_NO
			  	   AND S1.TSK_DIV_CD = 'UM' 
			  	)   AS POS_DTL_CD_NM
		     , A.NAME												/* 이름 */
		     , A.BIRTH												/* 생일 */
		     , A.GRADE												/* 기수 */
		     , A.AGE												/* 나이 */
		     , (SELECT S1.CD_NM										/* 성별구분코드 */
	   			  FROM TB_CODE S1
	   		INNER JOIN TB_CHRMGNT S2
	        		ON S1.CD_VL = S2.GNDR_DIV_CD
			  	 WHERE S2.CHR_NO = A.CHR_NO
			  	   AND S1.TSK_DIV_CD = 'UM' 
			  	)   AS GNDR_DIV_CD_NM  
		     , A.MB_TEL_NO											/* 핸드폰번호 */
		     , A.HM_TEL_NO											/* 집전화번호 */
		     , A.BASE_ADR											/* 기본주소 */
		     , A.DTL_ADR											/* 상세주소 */
		     , A.JOB												/* 직업 */
		     , A.EMAIL												/* 이메일 */
		     , (SELECT S1.CD_NM										/* 학력구분코드 */
	   			  FROM TB_CODE S1
	   		INNER JOIN TB_CHRMGNT S2
	        		ON S1.CD_VL = S2.EDU_DIV_CD
			  	 WHERE S2.CHR_NO = A.CHR_NO
			  	   AND S1.TSK_DIV_CD = 'UM'
			  	)   AS EDU_DIV_CD_NM	
		     , A.SCHOOL												/* 학교 */
		     , A.MAJOR												/* 전공 */
		     , (SELECT S1.CD_NM										/* 결혼상태코드 */
	   			  FROM TB_CODE S1
	  	 	INNER JOIN TB_CHRMGNT S2
	        		ON S1.CD_VL = S2.MRG_ST_CD
			  	 WHERE S2.CHR_NO = A.CHR_NO
			  	   AND S1.TSK_DIV_CD = 'UM' 
			  	)   AS MRG_ST_CD_NM	
		     , (SELECT S1.CD_NM										/* 세례상태코드 */
	   			  FROM TB_CODE S1
	   		INNER JOIN TB_CHRMGNT S2
	        		ON S1.CD_VL = S2.BPT_ST_CD
			  	 WHERE S2.CHR_NO = A.CHR_NO
			  	   AND S1.TSK_DIV_CD = 'UM' 
			  	)   AS BPT_ST_CD_NM	
		     , A.CELL_NO											/* 사랑방번호 */
		     , A.REMARK												/* 비고 */
		     , A.USR_ID												/* ID */
		     , A.VOL_DEPT_CD1										/* 봉사부서코드1 */
		     , (SELECT S1.CD_NM										/* 봉사부서이름1 */
		    	  FROM TB_CODE S1
		    INNER JOIN TB_CHRMGNT S2
		   		    ON S1.CD_VL = S2.VOL_DEPT_CD1
		   		 WHERE S2.CHR_NO = A.CHR_NO
		   		   AND S1.TSK_DIV_CD = 'UM'
		   	   ) VOL_DEPT_CD_NM1
		   	 , A.VOL_DEPT_CD2										/* 봉사부서코드2 */
		     , (SELECT S1.CD_NM										/* 봉사부서이름2 */
		    	  FROM TB_CODE S1
		    INNER JOIN TB_CHRMGNT S2
		   		    ON S1.CD_VL = S2.VOL_DEPT_CD2
		   		 WHERE S2.CHR_NO = A.CHR_NO
		   		   AND S1.TSK_DIV_CD = 'UM'
		   	   ) VOL_DEPT_CD_NM2
		     , A.FRS_REG_NO											/* 최초등록자번호 */
		     , A.FRS_REG_DT											/* 최초등록일시 */
		     , A.LST_MDF_NO											/* 최종수정자번호 */
		     , A.LST_MDF_DT											/* 최종수정일시 */
		  FROM TB_CHRMGNT A
		  WHERE A.CHR_NO NOT IN (1)
	]]>
	<if test="grade != null and grade != ''">
		   <!-- 기수 검색 -->	
		   AND A.GRADE LIKE CONCAT('%', #{grade}, '%')	
	</if>
	 <if test="gndrDivCd != null and gndrDivCd != ''">
		   <!-- 성별 검색 -->	
		   AND A.GNDR_DIV_CD = #{gndrDivCd}	
	</if>
	<if test="baseAdr != null and baseAdr != ''">
		   <!-- 주소 검색 -->	
		   AND A.BASE_ADR LIKE CONCAT('%', #{baseAdr}, '%')		
	</if>
	<if test="posDivCd != null and posDivCd != ''">
		   <!-- 직책 검색 -->	
		   AND A.POS_DIV_CD LIKE CONCAT('%', #{posDivCd}, '%')		
	</if>
	<if test="posDtlCd != null and posDtlCd != ''">
		   <!-- 직책 상세 검색 -->	
		   AND A.POS_DTL_CD LIKE CONCAT('%', #{posDtlCd}, '%')		
	</if>
	<if test="bptStCd != null and bptStCd != ''">
		   <!-- 세례 상태 검색 -->	
		   AND A.BPT_ST_CD LIKE CONCAT('%', #{bptStCd}, '%')		
	</if>
	<if test="volDeptCd1 != null and volDeptCd1 != ''">
		   <!-- 봉사부서 검색 -->	
		   AND A.VOL_DEPT_CD1 || A.VOL_DEPT_CD2 IN ( #{volDeptCd1} )		
	</if>
	<include refid="cm.com.pagingBottom" />
	</select>
	
	<!-- 검색에 따른 데이터 갯수 가져오기 -->
	<select id="memberTotalCnt" parameterType="umMemberDVO" resultType="int">
	<![CDATA[
	  	SELECT COUNT(*)
		  FROM (
			   SELECT A.CHR_NO										/* 교적번호 */
		     , A.CHR_REG_YMD										/* 교적등록일자 */
		     , A.CHR_DIV_CD											/* 교적구분코드 */
		     , A.POS_DIV_CD											/* 직책구분코드 */
		     , A.POS_DTL_CD											/* 직책상세코드 */
		     , A.NAME												/* 이름 */
		     , A.BIRTH												/* 생일 */
		     , A.GRADE												/* 기수 */
		     , A.AGE												/* 나이 */
		     , A.GNDR_DIV_CD										/* 성별구분코드 */
		     , A.MB_TEL_NO											/* 핸드폰번호 */
		     , A.HM_TEL_NO											/* 집전화번호 */
		     , A.BASE_ADR											/* 기본주소 */
		     , A.DTL_ADR											/* 상세주소 */
		     , A.JOB												/* 직업 */
		     , A.EMAIL												/* 이메일 */
		     , A.EDU_DIV_CD											/* 학력구분코드 */
		     , A.SCHOOL												/* 학교 */
		     , A.MAJOR												/* 전공 */
		     , A.MRG_ST_CD											/* 결혼상태코드 */
		     , A.BPT_ST_CD											/* 세례상태코드 */
		     , A.CELL_NO											/* 사랑방번호 */
		     , A.REMARK												/* 비고 */
		     , A.USR_ID												/* ID */
		     , A.VOL_DEPT_CD1										/* 봉사부서코드1 */
		   	 , A.VOL_DEPT_CD2										/* 봉사부서코드2 */
		     , A.FRS_REG_NO											/* 최초등록자번호 */
		     , A.FRS_REG_DT											/* 최초등록일시 */
		     , A.LST_MDF_NO											/* 최종수정자번호 */
		     , A.LST_MDF_DT											/* 최종수정일시 */
		  FROM TB_CHRMGNT A 
		  WHERE A.CHR_NO NOT IN (1)
	]]>	
	<if test="grade != null and grade != ''">
		   <!-- 기수 검색 -->	
		   AND A.GRADE LIKE CONCAT('%', #{grade}, '%')	
	</if>
	 <if test="gndrDivCd != null and gndrDivCd != ''">
		   <!-- 성별 검색 -->	
		   AND A.GNDR_DIV_CD = #{gndrDivCd}	
	</if>
	<if test="baseAdr != null and baseAdr != ''">
		   <!-- 주소 검색 -->	
		   AND A.BASE_ADR LIKE CONCAT('%', #{baseAdr}, '%')		
	</if>
	<if test="posDivCd != null and posDivCd != ''">
		   <!-- 직책 검색 -->	
		   AND A.POS_DIV_CD LIKE CONCAT('%', #{posDivCd}, '%')		
	</if>
	<if test="posDtlCd != null and posDtlCd != ''">
		   <!-- 직책 상세 검색 -->	
		   AND A.POS_DTL_CD LIKE CONCAT('%', #{posDtlCd}, '%')		
	</if>
	<if test="bptStCd != null and bptStCd != ''">
		   <!-- 세례 상태 검색 -->	
		   AND A.BPT_ST_CD LIKE CONCAT('%', #{bptStCd}, '%')		
	</if>
	<if test="volDeptCd1 != null and volDeptCd1 != ''">
		   <!-- 봉사부서 검색 -->	
		   AND A.VOL_DEPT_CD1 || A.VOL_DEPT_CD2 IN ( #{volDeptCd1} )		
	</if>
	<![CDATA[
		) A
	]]>	
	</select>
	
	<!-- 교적 단건 -->
	<select id="selectMember" parameterType="UmMemberDVO" resultType="UmMemberDVO">
	<![CDATA[
		SELECT A.CHR_NO												/* 교적번호 */
		     , A.CHR_REG_YMD										/* 교적등록일자 */
		     , A.CHR_DIV_CD											/* 교적구분코드 */
		     , (SELECT S1.CD_NM										/* 교적구분코드이름(출력변수) */
	   			  FROM TB_CODE S1
	   		INNER JOIN TB_CHRMGNT S2
	        		ON S1.CD_VL = S2.CHR_DIV_CD
			  	 WHERE S2.CHR_NO = A.CHR_NO
			  	   AND S1.TSK_DIV_CD = 'UM'
			  	)   AS CHR_DIV_CD_NM
			 , A.POS_DIV_CD											/* 직책구분코드 */
		     , (SELECT S1.CD_NM										/* 직책구분코드이름(출력변수) */
	   			  FROM TB_CODE S1
	   		INNER JOIN TB_CHRMGNT S2
	        		ON S1.CD_VL = S2.POS_DIV_CD
			  	 WHERE S2.CHR_NO = A.CHR_NO
			  	   AND S1.TSK_DIV_CD = 'UM'
			  	)   AS POS_DIV_CD_NM
			 , A.POS_DTL_CD											/* 직책상세코드 */
		     , (SELECT S1.CD_NM										/* 직책상세코드이름(출력변수) */
	   			  FROM TB_CODE S1
	   		INNER JOIN TB_CHRMGNT S2
	        		ON S1.CD_VL = S2.POS_DTL_CD
			  	 WHERE S2.CHR_NO = A.CHR_NO
			  	   AND S1.TSK_DIV_CD = 'UM' 
			  	)   AS POS_DTL_CD_NM
		     , A.NAME												/* 이름 */
		     , A.BIRTH												/* 생일 */
		     , A.GRADE												/* 기수 */
		     , A.AGE												/* 나이 */
		     , A.GNDR_DIV_CD										/* 성별구분코드 */
		     , (SELECT S1.CD_NM										/* 성별구분코드이름(출력변수) */
	   			  FROM TB_CODE S1
	   		INNER JOIN TB_CHRMGNT S2
	        		ON S1.CD_VL = S2.GNDR_DIV_CD
			  	 WHERE S2.CHR_NO = A.CHR_NO
			  	   AND S1.TSK_DIV_CD = 'UM' 
			  	)   AS GNDR_DIV_CD_NM
		     , A.MB_TEL_NO											/* 핸드폰번호 */
		     , A.HM_TEL_NO											/* 집전화번호 */
		     , A.BASE_ADR											/* 기본주소 */
		     , A.DTL_ADR											/* 상세주소 */
		     , A.JOB												/* 직업 */
		     , A.EMAIL												/* 이메일 */
		     , A.EDU_DIV_CD											/* 학력구분코드 */
		     , (SELECT S1.CD_NM										/* 학력구분코드이름(출력변수) */
	   			  FROM TB_CODE S1
	   		INNER JOIN TB_CHRMGNT S2
	        		ON S1.CD_VL = S2.EDU_DIV_CD
			  	 WHERE S2.CHR_NO = A.CHR_NO
			  	   AND S1.TSK_DIV_CD = 'UM'
			  	)   AS EDU_DIV_CD_NM
		     , A.SCHOOL												/* 학교 */
		     , A.MAJOR												/* 전공 */
		     , A.MRG_ST_CD											/* 결혼상태코드 */
		     , (SELECT S1.CD_NM										/* 결혼상태코드이름(출력변수) */
	   			  FROM TB_CODE S1
	  	 	INNER JOIN TB_CHRMGNT S2
	        		ON S1.CD_VL = S2.MRG_ST_CD
			  	 WHERE S2.CHR_NO = A.CHR_NO
			  	   AND S1.TSK_DIV_CD = 'UM' 
			  	)   AS MRG_ST_CD_NM
			 , A.BPT_ST_CD											/* 세례상태코드 */
		     , (SELECT S1.CD_NM										/* 세례상태코드이름(출력변수) */
	   			  FROM TB_CODE S1
	   		INNER JOIN TB_CHRMGNT S2
	        		ON S1.CD_VL = S2.BPT_ST_CD
			  	 WHERE S2.CHR_NO = A.CHR_NO
			  	   AND S1.TSK_DIV_CD = 'UM' 
			  	)   AS BPT_ST_CD_NM
		     , A.CELL_NO											/* 사랑방번호 */
		     , A.REMARK												/* 비고 */
		     , A.USR_ID												/* ID */
		     , A.VOL_DEPT_CD1										/* 봉사부서코드1 */
		     , (SELECT S1.CD_NM										/* 봉사부서이름1 */
		    	  FROM TB_CODE S1
		    INNER JOIN TB_CHRMGNT S2
		   		    ON S1.CD_VL = S2.VOL_DEPT_CD1
		   		 WHERE S2.CHR_NO = A.CHR_NO
		   		   AND S1.TSK_DIV_CD = 'UM'
		   	   ) VOL_DEPT_CD_NM1
		   	 , A.VOL_DEPT_CD2										/* 봉사부서코드2 */
		     , (SELECT S1.CD_NM										/* 봉사부서이름2 */
		    	  FROM TB_CODE S1
		    INNER JOIN TB_CHRMGNT S2
		   		    ON S1.CD_VL = S2.VOL_DEPT_CD2
		   		 WHERE S2.CHR_NO = A.CHR_NO
		   		   AND S1.TSK_DIV_CD = 'UM'
		   	   ) VOL_DEPT_CD_NM2
		     , A.FRS_REG_NO											/* 최초등록자번호 */
		     , A.FRS_REG_DT											/* 최초등록일시 */
		     , A.LST_MDF_NO											/* 최종수정자번호 */
		     , A.LST_MDF_DT											/* 최종수정일시 */
		  FROM TB_CHRMGNT A 
		 WHERE A.CHR_NO = #{chrNo}
	]]>
	</select>
	
	<!-- 교적 사진조회 -->
	<select id="selectMemberImage" parameterType="UmMemberDVO" resultType="CmFileDVO">
	<![CDATA[
		SELECT A.FILE_NO				/* 파일번호 */
		     , A.FILE_NM				/* 파일이름 */
		     , A.REF_NO					/* 참조번호 */
		     , A.REF_DIV_CD				/* 참조구분코드 */
		  FROM TB_FILE A 
		 WHERE A.REF_NO = #{chrNo}
		   AND A.REF_DIV_CD = 'USR'
		   AND A.REF_TB_KEY = #{slyouthTbKey}
	]]>
	</select>
	
	<!-- 교인정보 등록하기 -->
	<insert id="insertMember" parameterType="UmMemberDVO">
	<![CDATA[
		INSERT 
		  INTO TB_CHRMGNT
		       (
		        CHR_REG_YMD			/* 교적등록일자 */
		      , CHR_DIV_CD			/* 교적구분코드 */
		      , POS_DIV_CD			/* 직책구분코드 */
		      , POS_DTL_CD			/* 직책상세코드 */
		      , NAME				/* 이름 */
		      , BIRTH				/* 생일 */
		      , GRADE				/* 기수 */
		      , AGE					/* 나이 */
		      , GNDR_DIV_CD  		/* 성별구분코드 */
		      , MB_TEL_NO			/* 핸드폰번호 */
		      , HM_TEL_NO			/* 집전화번호 */
		      , BASE_ADR		    /* 기본주소 */
		      , DTL_ADR				/* 상세주소 */
		      , JOB					/* 직업 */
		      , EMAIL				/* 이메일 */
		      , EDU_DIV_CD			/* 학력구분코드 */
		      , SCHOOL				/* 학교 */
		      , MAJOR	     		/* 전공 */
		      , MRG_ST_CD			/* 결혼상태코드 */
		      , BPT_ST_CD			/* 세례상태코드 */
		      , CELL_NO	  			/* 사랑방번호 */
		      , REMARK				/* 비고 */
		      , VOL_DEPT_CD1		/* 봉사부서코드1 */
		      , VOL_DEPT_CD2		/* 봉사부서코드2 */
		      , FRS_REG_NO			/* 최초등록자번호 */
		      , FRS_REG_DT			/* 최초등록일시 */
		      , LST_MDF_NO			/* 최종수정자번호 */
		      , LST_MDF_DT	  		/* 최종수정일시 */
		       )
		VALUES (
			    #{chrRegYmd}
			  , #{chrDivCd}
			  , #{posDivCd}
			  , #{posDtlCd}
			  , #{name}
			  , #{birth}
			  , #{grade}
			  , #{age}
			  , #{gndrDivCd}
			  , #{mbTelNo}
			  , #{hmTelNo}
			  , #{baseAdr}
			  , #{dtlAdr}
			  , #{job}
			  , #{email}
			  , #{eduDivCd}
			  , #{school}
			  , #{major}
			  , #{mrgStCd}
			  , #{bptStCd}
			  , #{cellNo}
			  , #{remark}
			  , #{volDeptCd1}
			  , #{volDeptCd2}
			  , #{frsRegNo}
			  , NOW()
			  , #{lstMdfNo}
			  , NOW()
			   )
	]]>
	<selectKey keyProperty="chrNo" resultType="int" order="AFTER">
		SELECT LAST_INSERT_ID()
	</selectKey>
	</insert>
	
	<!-- 교인정보 수정하기 -->
	<update id="updateMember" parameterType="UmMemberDVO">
	<![CDATA[
		UPDATE TB_CHRMGNT
		   SET 
		        CHR_REG_YMD = #{chrRegYmd}					/* 교적등록일자 */
		      , CHR_DIV_CD = #{chrDivCd}					/* 교적구분코드 */
		      , POS_DIV_CD = #{posDivCd}					/* 직책구분코드 */
		      , POS_DTL_CD = #{posDtlCd}					/* 직책상세코드 */
		      , NAME = #{name}								/* 이름 */
		      , BIRTH = #{birth}							/* 생일 */
		      , GRADE = #{grade}							/* 기수 */
		      , AGE	= #{age}								/* 나이 */
		      , GNDR_DIV_CD = #{gndrDivCd}	 				/* 성별구분코드 */
		      , MB_TEL_NO = #{mbTelNo}						/* 핸드폰번호 */
		      , HM_TEL_NO = #{hmTelNo}						/* 집전화번호 */
		      , BASE_ADR = #{baseAdr}			    		/* 기본주소 */
		      , DTL_ADR = #{dtlAdr}							/* 상세주소 */
		      , JOB	= #{job}								/* 직업 */
		      , EMAIL = #{email}							/* 이메일 */
		      , EDU_DIV_CD = #{eduDivCd}					/* 학력구분코드 */
		      , SCHOOL = #{school}							/* 학교 */
		      , MAJOR = #{major}		     				/* 전공 */
		      , MRG_ST_CD = #{mrgStCd}						/* 결혼상태코드 */
		      , BPT_ST_CD = #{bptStCd}						/* 세례상태코드 */
		      , CELL_NO	= #{cellNo}		  					/* 사랑방번호 */
		      , REMARK = #{remark}							/* 비고 */
		      , USR_ID = #{usrId}				    		/* ID */
		      , VOL_DEPT_CD1 = #{volDeptCd1}				/* 봉사부서코드1 */
		      , VOL_DEPT_CD2 = #{volDeptCd2}				/* 봉사부서코드2 */
		      , LST_MDF_NO = #{lstMdfNo}					/* 최종수정자번호 */
		      , LST_MDF_DT = NOW()	  						/* 최종수정일시 */
		 WHERE CHR_NO = #{chrNo}
	]]>
	</update>
	
	<!-- 교적데이터 삭제 -->
	<delete id="deleteMember" parameterType="umMemberDVO">
	<![CDATA[
		DELETE FROM
			   TB_CHRMGNT
		 WHERE CHR_NO = #{chrNo}
	]]>
	</delete>
	
	<!-- 교적 ID 갱신 -->
	<update id="updateMemberId" parameterType="CmLoginDVO">
	<![CDATA[
		UPDATE TB_CHRMGNT
	  	   SET USR_ID = #{usrId}
	  	 WHERE CHR_NO = #{chrNo}
	]]>
	</update>
	
	<!-- 모달 멤버추가 리스트 -->
	<select id="selectChrMemberModal" parameterType="UmMemberDVO" resultType="UmMemberDVO">
	
	<![CDATA[
		SELECT A.CHR_NO												/* 교적번호 */
		     , A.CHR_REG_YMD										/* 교적등록일자 */
		     , (SELECT S1.CD_NM										/* 교적구분코드 */
	   			  FROM TB_CODE S1
	   		INNER JOIN TB_CHRMGNT S2
	        		ON S1.CD_VL = S2.CHR_DIV_CD
			  	 WHERE S2.CHR_NO = A.CHR_NO
			  	   AND S1.TSK_DIV_CD = 'UM'
			  	)   AS CHR_DIV_CD
		     , (SELECT S1.CD_NM										
	   			  FROM TB_CODE S1
	   		INNER JOIN TB_CHRMGNT S2
	        		ON S1.CD_VL = S2.POS_DIV_CD
			  	 WHERE S2.CHR_NO = A.CHR_NO
			  	   AND S1.TSK_DIV_CD = 'UM'
			  	)   AS POS_DIV_CD									/* 직책구분코드 */
		     , (SELECT S1.CD_NM										
	   			  FROM TB_CODE S1
	   		INNER JOIN TB_CHRMGNT S2
	        		ON S1.CD_VL = S2.POS_DTL_CD
			  	 WHERE S2.CHR_NO = A.CHR_NO
			  	   AND S1.TSK_DIV_CD = 'UM' 
			  	)   AS POS_DTL_CD									/* 직책상세코드 */
		     , A.NAME												/* 이름 */
		     , A.BIRTH												/* 생일 */
		     , A.GRADE												/* 기수 */
		     , A.AGE												/* 나이 */
		     , (SELECT S1.CD_NM										
	   			  FROM TB_CODE S1
	   		INNER JOIN TB_CHRMGNT S2
	        		ON S1.CD_VL = S2.GNDR_DIV_CD
			  	 WHERE S2.CHR_NO = A.CHR_NO
			  	   AND S1.TSK_DIV_CD = 'UM' 
			  	)   AS GNDR_DIV_CD  								/* 성별구분코드 */
		     , A.MB_TEL_NO											/* 핸드폰번호 */
		     , A.BASE_ADR											/* 기본주소 */
		     , A.DTL_ADR											/* 상세주소 */
		     , A.JOB												/* 직업 */
		     , A.EMAIL												/* 이메일 */
		     , (SELECT S1.CD_NM										/* 학력구분코드 */
	   			  FROM TB_CODE S1
	   		INNER JOIN TB_CHRMGNT S2
	        		ON S1.CD_VL = S2.EDU_DIV_CD
			  	 WHERE S2.CHR_NO = A.CHR_NO
			  	   AND S1.TSK_DIV_CD = 'UM'
			  	)   AS EDU_DIV_CD	
		     , A.SCHOOL												/* 학교 */
		     , A.MAJOR												/* 전공 */
		     , (SELECT S1.CD_NM										/* 결혼상태코드 */
	   			  FROM TB_CODE S1
	  	 	INNER JOIN TB_CHRMGNT S2
	        		ON S1.CD_VL = S2.MRG_ST_CD
			  	 WHERE S2.CHR_NO = A.CHR_NO
			  	   AND S1.TSK_DIV_CD = 'UM' 
			  	)   AS MRG_ST_CD	
		     , (SELECT S1.CD_NM										/* 세례상태코드 */
	   			  FROM TB_CODE S1
	   		INNER JOIN TB_CHRMGNT S2
	        		ON S1.CD_VL = S2.BPT_ST_CD
			  	 WHERE S2.CHR_NO = A.CHR_NO
			  	   AND S1.TSK_DIV_CD = 'UM' 
			  	)   AS BPT_ST_CD	
		     , A.CELL_NO											/* 사랑방번호 */
		     , A.USR_ID												/* ID */
		     , A.FRS_REG_DT											/* 최초등록일시 */
		     , A.LST_MDF_DT											/* 최종수정일시 */
		  FROM TB_CHRMGNT A
		  WHERE 1=1
	]]>
	<if test="modalDivCd == 'CIR'">
		   <!-- 동아리 멤버이 있는 사람 제외 -->	
		   AND A.CHR_NO NOT IN (
		   	   					 SELECT S2.CHR_NO
		  						   FROM TB_EVENT S1
		  					 INNER JOIN TB_EVENT_APP S2
		  						        ON S1.EVENT_NO = S2.EVENT_NO
		  						       AND S2.APP_YN = 'Y'
		   						)	
	</if>
	
	</select>
</mapper>